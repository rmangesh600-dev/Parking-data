<!DOCTYPE html>
<html lang="mr">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin Dashboard - पार्किंग</title>
<style>
body{font-family:system-ui;background:#081027;color:#eaf4ff;margin:0;padding:16px}
.wrap{max-width:1100px;margin:0 auto}
.table{width:100%;border-collapse:collapse;margin-top:12px}
.table th, .table td{padding:8px;border-bottom:1px solid rgba(255,255,255,.04);font-size:14px}
.controls{display:flex;gap:8px;align-items:center}
.btn{padding:8px 10px;border-radius:8px;background:#ffd54f;border:none;cursor:pointer}
.small{color:#9fb6d1;font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <h1>Admin Dashboard</h1>
  <div class="controls">
    <button class="btn" onclick="load()">लिहा नोंदी लोड करा</button>
    <button class="btn" onclick="exportCsv()">CSV एक्सपोर्ट</button>
    <button class="btn" onclick="sendDaily()">दिवसाचा रिपोर्ट पाठवा</button>
    <input id="search" placeholder="गाडी/मोबाईल शोध" oninput="load()"/>
  </div>
  <table class="table" id="tbl"><thead><tr><th>ID</th><th>वाहन</th><th>मोबाईल</th><th>प्रकार</th><th>रक्कम</th><th>एंट्री</th><th>एक्पायरी</th></tr></thead><tbody></tbody></table>
  <div class="small">नोट: SMS/WhatsApp व ईमेल सक्षम करण्यासाठी .env फाईल कॉन्फिग करा.</div>
</div>
<script>
async function load(){
  const q = document.getElementById('search').value.trim();
  const res = await fetch('/api/parkings?q='+encodeURIComponent(q));
  const j = await res.json();
  const tbody = document.querySelector('#tbl tbody');
  tbody.innerHTML='';
  (j.data||[]).forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.vehicleNo}</td><td>${r.mobile}</td><td>${r.vehicleType}</td><td>₹${r.amount}</td><td>${new Date(r.paidAt).toLocaleString()}</td><td>${r.expiresAt?new Date(r.expiresAt).toLocaleString():'-'}</td>`;
    tbody.appendChild(tr);
  });
}
function exportCsv(){
  fetch('/api/export').then(r=>r.blob()).then(b=>{
    const url = URL.createObjectURL(b);
    const a = document.createElement('a'); a.href=url; a.download='parkings.csv'; a.click();
  });
}
function sendDaily(){ fetch('/api/send-daily-report').then(r=>r.json()).then(j=>alert(j.ok? 'Sent' : 'Error')) }
load();
</script>
</body>
</html>
